# Production-oriented overrides for prometheus-community/kube-prometheus-stack
fullnameOverride: kube-prom-stack
namespaceOverride: monitoring

# -------------------------
# Prometheus (TSDB)
# -------------------------
prometheus:
  enabled: true
  prometheusSpec:
    replicas: 2

    retention: 15d
    retentionSize: "80GB"
    scrapeInterval: 30s
    evaluationInterval: 30s

    enableAdminAPI: false
    walCompression: true

    # Persistence (PVC) â€” per replica
    storageSpec:
      volumeClaimTemplate:
        spec:
          storageClassName: vsphere-ds-powerstore
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 100Gi

    resources:
      requests:
        cpu: "500m"
        memory: "2Gi"
      limits:
        cpu: "2"
        memory: "6Gi"

    # Spread replicas across nodes
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values: ["prometheus"]
            topologyKey: kubernetes.io/hostname

    serviceMonitorSelectorNilUsesHelmValues: false
    podMonitorSelectorNilUsesHelmValues: false
    ruleSelectorNilUsesHelmValues: false

  # Ingress OFF
  ingress:
    enabled: false

  # Service -> NodePort
  service:
    type: NodePort
    nodePort: 30900

# -------------------------
# Alertmanager
# -------------------------
alertmanager:
  enabled: true
  alertmanagerSpec:
    replicas: 2

    # Persistence (PVC)
    storage:
      volumeClaimTemplate:
        spec:
          storageClassName: vsphere-ds-powerstore
          accessModes: ["ReadWriteOnce"]
          resources:
            requests:
              storage: 50Gi

    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

    # Spread replicas across nodes
    affinity:
      podAntiAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          - labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values: ["alertmanager"]
            topologyKey: kubernetes.io/hostname

  # Ingress OFF
  ingress:
    enabled: false

  # Service -> NodePort
  service:
    type: NodePort
    nodePort: 30901

# -------------------------
# Grafana (DISABLED)
# -------------------------
grafana:
  enabled: false
  ingress:
    enabled: false
  persistence:
    enabled: false

# -------------------------
# Exporters / kube-state-metrics
# -------------------------
kubeStateMetrics:
  enabled: true

nodeExporter:
  enabled: true

# -------------------------
# Default rules
# -------------------------
defaultRules:
  create: true

# -------------------------
# Prometheus Operator (controller)
# -------------------------
prometheusOperator:
  enabled: true
  resources:
    requests:
      cpu: "100m"
      memory: "256Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

# -------------------------
# Admission webhooks
# -------------------------
prometheusOperatorAdmissionWebhooks:
  enabled: true